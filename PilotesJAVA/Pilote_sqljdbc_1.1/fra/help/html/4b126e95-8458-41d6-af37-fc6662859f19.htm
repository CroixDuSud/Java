<html DIR="LTR" xmlns:tool="http://www.microsoft.com/tooltip" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
  <head>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=Windows-1252" />
    <META NAME="save" CONTENT="history" />
    <title>Utilisation d'une procédure stockée avec retour d'état</title>
    
    <link rel="stylesheet" type="text/css" href="../local/Classic.css">
      
    </link>
    
    <script src="../local/script_loc.js">
      
    </script>
    <script src="../local/script_main.js">
      
    </script>
  </head>
  <body style="display: none;">
    <!--Topic built:11/3/2006-->
<input type="hidden" id="userDataCache" class="userDataStyle">
    </input>
    <input type="hidden" id="hiddenScrollOffset">
    </input>
    <div id="header">
        <tr>
          <td align="left">
            <span id="headerBold">Utilisation d'une procédure stockée avec retour d'état</span>
          </td>
        </tr>
      </table>
      <IMG id="SeeAlso1" style="display:none; height:0; width:0;" src="../local/SeeAlso1a.gif">
        
      </IMG>
      <IMG id="SeeAlso2" style="display:none; height:0; width:0;" src="../local/SeeAlso1c.gif">
        
      </IMG>
      <IMG id="Filter1" style="display:none; height:0; width:0;" src="../local/Filter1a.gif">
        
      </IMG>
      <IMG id="Filter2" style="display:none; height:0; width:0;" src="../local/Filter1c.gif">
        
      </IMG>
      <span style="display:none" id="languageSpan">
        <h1 class="heading">
          Langage
        </h1>
        <div id="selectLanguage" class="section">
          <div class="languageFilter" id="VisualBasic" onclick="ChangeLanguage(this.id)" onkeypress="ChangeLanguage_CheckKey(this.id)" tabindex="0">
            [Visual Basic]
          </div>
          <div class="languageFilter" id="CSharp" onclick="ChangeLanguage(this.id)" onkeypress="ChangeLanguage_CheckKey(this.id)" tabindex="0">
            [C#]
          </div>
          <div class="languageFilter" id="ManagedCPlusPlus" onclick="ChangeLanguage(this.id)" onkeypress="ChangeLanguage_CheckKey(this.id)" tabindex="0">
            [C++]
          </div>
          <div class="languageFilter" id="JSharp" onclick="ChangeLanguage(this.id)" onkeypress="ChangeLanguage_CheckKey(this.id)" tabindex="0">
            [J#]
          </div>
          <div class="languageFilter" id="JScript" onclick="ChangeLanguage(this.id)" onkeypress="ChangeLanguage_CheckKey(this.id)" tabindex="0">
            [JScript]
          </div>
          <div class="languageFilter" id="all" onclick="ChangeLanguage(this.id)" onkeypress="ChangeLanguage_CheckKey(this.id)" tabindex="0">
            (Afficher tout)
          </div>
        </div>
      </span>
    </div>
    <div id="mainSection">
      <div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()">
      </div>
      <font color="DarkGray"><!-- [This topic is pre-release documentation and is subject to change in future releases. Blank topics are included as placeholders.]<br/>[Documentation built on 11/3/2006]  --></font><p /><p />
      <div id="introductionSection" class="section">
    <p>Une procédure stockée SQL Server que vous pouvez appeler est une procédure qui retourne un paramètre de statut (ou résultat). Cette procédure permet généralement d'indiquer la réussite ou l'échec de la procédure stockée. Le pilote JDBC de Microsoft de SQL Server 2005 intègre la classe <a href="30710a63-c05d-47d9-9cf9-c087a1c76373.htm">SQLServerCallableStatement</a> que vous pouvez utiliser pour appeler ce type de procédure stockée et traiter les données qu'elle retourne.</p>
    <p>Lorsque vous appelez ce type de procédure stockée à l'aide du pilote JDBC, vous devez utiliser la séquence d'échappement SQL <code>call</code> conjointement avec la méthode <a href="265b024c-898a-4bd0-98b5-f06076717b9e.htm">prepareCall</a> de la classe <a href="937292a6-1525-423e-a2b2-a18fd34c2893.htm">SQLServerConnection</a>. La syntaxe de la séquence d'échappement <code>call</code> avec un paramètre de retour d'état est la suivante :</p>
    <p><code>{[?=]call procedure-name[([parameter][,[parameter]]...)]}</code></p>
    <div style="margin: .5em 1.5em .5em 1.5em"><b>Remarque : </b>
      Pour plus d'informations sur les séquences d'échappement SQL, voir <a href="00f9e25a-088e-4ac6-aa75-43eacace8f03.htm">Utilisation de séquences d'échappement SQL</a>.<p></p>
    </div>
    <p>Lorsque vous construisez la séquence d'échappement<code> call </code>, spécifiez le paramètre de retour d'état l'aide du caractère ? (point d'interrogation). Ce caractère fait office d'espace réservé pour la valeur de paramètre qui est retournée par la procédure stockée. Pour spécifier une valeur pour un paramètre de retour d'état, vous devez spécifier le type de données du paramètre à l'aide de la méthode <a href="82f8d608-efc1-4af8-a985-ec25d19420aa.htm">registerOutParameter</a> de la classe <b>SQLServerCallableStatement</b> avant d'exécuter la procédure stockée. </p>
    <div style="margin: .5em 1.5em .5em 1.5em"><b>Remarque : </b>
      Lors de l'utilisation du pilote JDBC avec une base de données SQL Server, la valeur spécifiée pour le paramètre de retour d'état dans la méthode <b>registerOutParameter</b> est toujours un nombre entier que vous pouvez spécifier à l'aide du type de données java.sql.Types.INTEGER.<p></p>
    </div>
    <p>En outre, lorsque vous transmettez une valeur à la méthode <b>registerOutParameter</b> pour un paramètre de retour d'état, vous devez spécifier non seulement le type de données à utiliser pour le paramètre, mais également la position ordinale de celui-ci dans l'appel de procédure stockée. La position ordinale du paramètre de retour d'état est toujours 1 car il s'agit toujours du premier paramètre de l'appel à la procédure stockée.</p>
    <p>Par exemple, créez la procédure stockée suivante dans l'exemple de base de données SQL Server 2005 AdventureWorks :</p>
    <div class="sampleCode"><span codeLanguage="other"><pre>CREATE PROCEDURE CheckContactCity
   @cityName CHAR(50)
AS
BEGIN
   IF ((SELECT COUNT(*)
   FROM Person.Address
   WHERE City = @cityName) &gt; 1)
   RETURN 1
ELSE
   RETURN 0
END</pre></span></div>
    <p>Cette procédure stockée retourne une valeur de statut 1 ou 0, selon que la ville spécifiée dans le paramètre cityName figure ou non dans la table Person.Address.</p>
    <p>Dans l'exemple suivant, une connexion ouverte à l'exemple de base de données AdventureWorks est transmise à la fonction et la méthode <a href="e1367f39-23d7-4e26-b160-6d988d7e6988.htm">execute</a> permet d'appeler la procédure stockée CheckContactCity.</p>
    <div class="sampleCode">
		<span class="langLabel" name="label"></span><span codeLanguage="other"><pre>public static void executeStoredProcedure(Connection con) {
   try {
      CallableStatement cstmt = con.prepareCall("{? = call dbo.CheckContactCity(?)}");
      cstmt.registerOutParameter(1, java.sql.Types.INTEGER);
      cstmt.setString(2, "Atlanta");
      cstmt.execute();
      System.out.println("RETURN STATUS: " + cstmt.getInt(1));
   }
   cstmt.close();
   catch (Exception e) {
      e.printStackTrace();
   }
}
</pre></span>
	</div>
  </div>
      <span id="seeAlsoSpan">
        <h1 class="heading">
          Voir aussi
        </h1>
        <div id="seeAlsoSection" class="section">
          <a href="0041f9e1-09b6-4487-b052-afd636c8e89a.htm">Utilisation d'instructions avec des procédures stockées</a>
        </div>
      </span>
      <!--[if gte IE 5]>
			<tool:tip element="seeAlsoToolTip" avoidmouse="false"/><tool:tip element="languageFilterToolTip" avoidmouse="false"/>
		<![endif]-->
      <div id="footer" class="section">
        <hr /><A NAME="feedback"></A><span id="fb" class="feedbackcss"></span>
		<a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">
			
			© 2006 Microsoft Corporation. Tous droits réservés.
		</a>
 	
      </div>
    </div>
  </body>
</html>